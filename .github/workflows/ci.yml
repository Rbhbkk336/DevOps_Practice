name: CI Build

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: "Telegram notification: Build started"
              uses: appleboy/telegram-action@v0.1.0
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  message: "üöÄ –°–±–æ—Ä–∫–∞ CI –¥–ª—è –≤–µ—Ç–∫–∏ ${{ github.ref_name }} –Ω–∞—á–∞–ª–∞—Å—å"

            - name: Set up PHP
              uses: shivammathur/setup-php@v2
              with:
                  php-version: '8.3'
                  extensions: mbstring, intl, pdo, pdo_pgsql, zip, gd

            - name: Install Composer dependencies
              run: composer install --no-interaction --optimize-autoloader

            - name: Build Docker image
              run: docker build -t symfony-app .

            - name: "Telegram notification: Build success"
              if: success()
              uses: appleboy/telegram-action@v0.1.0
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  message: "‚úÖ CI —Å–±–æ—Ä–∫–∞ –¥–ª—è –≤–µ—Ç–∫–∏ ${{ github.ref_name }} –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ"

            - name: "Telegram notification: Build failed"
              if: failure()
              uses: appleboy/telegram-action@v0.1.0
              with:
                  to: ${{ secrets.TELEGRAM_CHAT_ID }}
                  token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
                  message: "‚ùå CI —Å–±–æ—Ä–∫–∞ –¥–ª—è –≤–µ—Ç–∫–∏ ${{ github.ref_name }} –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —Å –æ—à–∏–±–∫–æ–π"
